# 推荐系统总结

## 传统推荐模型

### 传统推荐模型的演化关系图

![test](2023-05-06-10-35-09.png)

1. **协同过滤算法族**：经典的协同过滤算法曾是推荐系统的首选模型，从物品相似度和用户相似度角度出发，协同过滤衍生出物品协同过滤（ItemCF） 和用户协同过滤（UserCF）两种算法。为了使协同过滤能够更好地处理稀疏共现矩阵问题、增强模型的泛化能力，从协同过滤衍生出矩阵分解模型（Matrix Factorization, MF），并发展出矩阵分解的各分支模型。
2. **逻辑回归模型族**：与协同过滤仅利用用户和物品之间的显式或隐式反馈信息相比，逻辑回归能够利用和融合更多用户、物品及上下文特征。从LR 模型衍生出的模型同样“枝繁叶茂”，包括增强了非线性能力的大规模分片线性模型（Large Scale Piece-wise Linear Model, LS-PLM）, 由逻辑回归发展出来的FM 模型，以及与多种不同模型配合使用后的组合模型，等等。
3. **因子分解机模型族**：因子分解机在传统逻辑回归的基础上，加入了二阶部分，使模型具备了进行特征组合的能力。更进一步，在因子分解机基础上发展出来的域感知因子分解机（Field-aware Factorization Machine, FFM）则通过加入特征域的概念，进一步加强了因子分解机特征交叉的能力。
4. **组合模型**：为了融合多个模型的优点，将不同模型组合使用是构建推荐模型常用的方法。Facebook 提出的GBDT+LR[ 梯度提升决策树(Gradient Boosting Decision Tree)+逻辑回归] 组合模型是在业界影响力较大的组合方式。此外，组合模型中体现出的特征工程模型化的思想，也成了深度学习推荐模型的引子和核心思想之一。

### 协同过滤

协同过滤算法，主要是利用用户在商品上的交互行，把用户和商品构建成共现矩阵的形式，用户作为矩阵的行坐标，商品作为列坐标，将用户在对应商品上的行为数据转换为矩阵中相应的元素值。如下图所示:
![共现矩阵](2023-05-06-11-10-09.png)

#### 基于用户的协同过滤算法

基于用户的协同过滤算法比较重要的步骤

1. **用户相似度计算**

* 余弦相似度：计算用户向量之间的余弦相似度。
$sim(i, j)=cos(i, j)=\frac{i\cdot j}{||i||\cdot||j||}$
* 皮尔逊相关系数：相比余弦相似度，皮尔逊相关系数通过使用用户平均分对各独立评分进行修正，减小了用户评分偏置的影响
$r_{xy}=\frac{\sum_{i=1}^{n}(x_i-\bar{x})(y_i-\bar{y})}{\sqrt{\sum_{i=1}^{n}(x_i-\bar{x})^2}\sqrt{\sum_{i=1}^{n}(y_i-\bar{y})^2}}$
其中，$x_1, x_2, ..., x_n$和$y_1, y_2, ..., y_n$是两个变量在$n$个样本中的取值，$\bar{x}$和$\bar{y}$分别是$x$和$y$的样本均值。$r_{xy}$的取值范围为$[-1, 1]$，表示$x$和$y$之间的线性相关程度，当$r_{xy}=1$时，表示$x$和$y$呈完全正相关；当$r_{xy}=-1$时，表示$x$和$y$呈完全负相关；当$r_{xy}=0$时，表示$x$和$y$不相关。
* 基于皮尔逊系数的思路，还可以通过引入物品平均分的方式，减少物品评分偏置对结果的影响
![减少物品评分偏置](2023-05-06-11-26-25.png)

2. **最终结果排序**
在获得Top n相似用户之后，利用Top n用户生成最终推荐结果的过程如下。假设“目标用户与其相似用户的喜好是相似的”，可根据相似用户的已有评价对目标用户的偏好进行预测。这里最常用的方式是利用用户相似度和相似用户的评价的加权平均获得目标用户的评价预测：
![t](2023-05-06-11-29-27.png)

3. **基于用户的协同过滤算法的缺点**
   1. 在互联网应用的场景下，用户数往往大于物品数，而UserCF需要维护用户相似度矩阵以便快速找出TOP N相似用户。该用户相似度矩阵的存储开销非常大，而且随着业务的发展，用户数的增长会导致用户相似度矩阵的空间以$n^2$的速度快速增长，这是在线存储系统难以承受的扩展速度。
   2. 用户的历史数据向量往往非常稀疏，对于只有几次购买或者点击行为的用户来说，找到相似用户的准确度非常低的，这导致UserCF不适用于那些正反馈获取较困难的的应用场景（如酒店预订，大件商品购买等低频应用）。

#### 基于物品的协同过滤

1. 基于历史数据，构建以用户（假设用户总数为m）为行坐标，物品（物品总数为n）为列坐标的 $m\times n$ 维的共现矩阵。
2. 计算共现矩阵两两列向量间的相似性（相似度计算方式与用户相似度的计算方式相同），构建 $n\times n$ 的物品相似度矩阵。
3. 获得用户历史行为数据中的正反馈物品列表。
4. 利用物品相似度矩阵，针对目标用户历史行为中的正反馈物品，找出相似的$Top K$个物品，组成相似物品集合。
5. 对相似物品集合中的物品，利用相似度分值进行排序，生成最终的推荐列表。
![t](2023-05-06-13-01-25.png)

#### UserCF与ItemCF的应用场景

1. UserCF基于用户相似度进行推荐，使其具备更强的社交特性，用户能够快速得知与自己兴趣相似的人最近喜欢的是什么，即使某个兴趣点以前不在自己的兴趣范围内，也可以通过“朋友”的动态快速更新自己的推荐列表。这样的特点使其非常适用于新闻推荐场景。因为新闻本身的兴趣点往往是分散的，相比用户对不同新闻的兴趣偏好，新闻的及时性、热点性往往是其更重要的属性，而UserCF正适用于发现热点，以及跟踪热点的趋势。
2. ItemCF更适用于兴趣变化比较稳定的应用，比如在Amazon的电商场景中，用户在一个时间段内更倾向于寻找一类商品，这时利用物品相似度为其推荐相关物品是契合用户动机的，在Netflix的视频推荐场景中，用户观看电影、电视剧的兴趣点往往比较稳定，因此利用ItemCF推荐风格、类型相似的视频是更合理的选择。

### 协同过滤的缺陷

1. **头部效应**
协同过滤不具备较强的泛化能力，协同过滤无法将两个物品相似这一信息推广到其他物品的相似性计算上。这就导致了一个比较严重的问题——热门的物品具有很强的头部效应，容易跟大量物品产生相似性；而尾部的物品由于特征向量稀疏，很少与其他物品产生相似性，导致很少被推荐。
![t](2023-05-06-13-15-04.png)
为了解决上述问题，同时增加模型的泛化能力，矩阵分解技术被提出。该方法在协同过滤共现矩阵上，使用更稠密的隐向量表示用户和物品，挖掘用户和物品的隐含兴趣和隐含特征，在一定程度上弥补了协同过滤模型处理稀疏矩阵能力不足的问题。
2. **利用有效信息不充分**
协同过滤仅利用用户和物品的交互信息，无法有效地引入用户年龄、性别、商品描述、商品分类、当前时间等一系列用户特征、物品特征和上下文特征，这无疑造成了有效信息的遗漏。为了在推荐模型中引入这些特征，推荐系统逐渐发展到以逻辑回归模型为核心的、能够综合不同类型特征的机器学习模型的道路上。
